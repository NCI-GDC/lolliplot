import 'babel-polyfill'
import ProteinLolliplot, { setupStore } from '@oncojs/lolliplot'
import mockData from '@oncojs/lolliplot/data'
import * as d3 from 'd3'

let domainWidth = 500
let store = setupStore({ domainWidth })

let root = document.querySelector(`#root`)

// -- for testing d3@3
// let d3 = window.d3

let proteinLolliplot, draw, remove
proteinLolliplot = ProteinLolliplot({
  element: root,
  data: mockData(80),
  clickHandler: d => console.log(d),
  height: 450,
  domainWidth,
  mutationId: `MU10`,
  store,
  d3,
})

draw = proteinLolliplot.draw
remove = proteinLolliplot.remove

/*----------------------------------------------------------------------------*/

let range = document.querySelector(`#mut-count`)
let label = document.querySelector(`#mut-count-label`)

let zoomMinInput = document.querySelector(`#zoom-min`)
let zoomMaxInput = document.querySelector(`#zoom-max`)

zoomMinInput.value = 0
zoomMaxInput.value = domainWidth

store.subscribe(() => {
  let { targetMin, targetMax } = store.getState()
  zoomMinInput.value = targetMin
  zoomMaxInput.value = targetMax
})

zoomMinInput.addEventListener(`input`, e => {
  store.update({
    animating: true,
    targetMin: +e.target.value,
    targetMax: store.getState().targetMax,
  })
  draw()
})

zoomMaxInput.addEventListener(`input`, e => {
  store.update({
    animating: true,
    targetMin: store.getState().targetMin,
    targetMax: +e.target.value,
  })
  draw()
})

window.range = range

range.oninput = event => {
  remove()
  label.innerText = event.target.value
  proteinLolliplot = ProteinLolliplot({
    element: root,
    data: mockData(+event.target.value),
    clickHandler: d => console.dir(d),
    height: 450,
    domainWidth,
    mutationId: `MU10`,
    store,
    d3,
  })

  draw = proteinLolliplot.draw
  remove = proteinLolliplot.remove
}

window.addEventListener(`resize`, () => {
  remove()
  proteinLolliplot = ProteinLolliplot({
    element: root,
    data: mockData(80),
    clickHandler: d => console.dir(d),
    height: 450,
    mutationId: `MU10`,
    store,
    d3,
  })

  draw = proteinLolliplot.draw
  remove = proteinLolliplot.remove
})
